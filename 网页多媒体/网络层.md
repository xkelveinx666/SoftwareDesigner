# 网络层
### 重要功能
1. 路由选择（路由器主要功能）
2. 分组转发
### 虚电路
1. 一条逻辑上的连接，分组沿着逻辑连接按照存储转发传送
2. 两个计算机通信，先建立连接，保证双方通信所需的一切网络资源

### 数据报服务
1. 网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
2. 网络在发送分组不建立连接，分组(IP数据报)独立发送

### 中间设备
|层次|中间设备|
|-|-|
|物理层|转发器(repeater)、集线器(HUB)|
|数据链路层|网桥、桥接器(bridge)、交换机(switch)|
|网络层|路由器(router)|
|网络层以上|网关(gateway)|

### 虚拟互联网络
1.不同的计算机网络互连时都使用相同的网际协议IP

### IP协议及配套协议
![](https://ooo.0o0.ooo/2017/06/25/594f67b328420.png)

### IP地址
- ip地址由两个字段组成
> 1. 网络号 net-id 主机说连接的网络
> 2. 主机号 host-id 该主机
- 点分十进制法
> 1. ip地址一共32位
> 2. 每8位二进制位转为一个10进制
- ip地址分类
> 1. A类地址网络号范围:1 ~ 126
> 2. B类地址网络号范围:128.1~191.255
> 3. C类地址网络号范围:192.0.1~223.255.255
> ![](https://ooo.0o0.ooo/2017/06/25/594f681fd22ea.png)
- 特殊用途地址
> 1. 直接广播地址:主机号全为"1"用于广播，向网上所有主机发送报文
> 2. 受限广播地址:当32位地址全"1"时，该地址用于本网广播
> 3. 网络号全"0"或主机号全"0",主机号或网络号表示本网网址
> 4. 回送测试:127.x.x.x用于网络软件测试及本地机进程间通讯
- 重要特点
1. IP地址是一种分等级的地址结构,网络号与主机号由不同单位分配，管理方便,路由器只考虑网络号，路由表减少
2. IP地址标志一个主机和一条链路的接口
3. 用转发器或网桥连接的若干个局域网仍为一个网络
4. 在同一网络号的网络，是平等的

### IP地址的转化
- IP地址放在IP数据报的首部，而硬件地址放在MAC帧的首部，网络层和网络成以上使用的是IP地址，数据链路层及以下使用的是硬件地址
- ![](https://ooo.0o0.ooo/2017/06/25/594f70a5af4c1.png)

### ARP协议
1. 将IP地址转化为物理地址
2. 属于网络层
3. 在主机ARP高速缓存中存放IP地址到硬件地址的映射表，动态更新
4. 封装在以太帧

### IP地址转发分组
1. 从数据报中提取目的主机IP地址，得出网络地址
2. 依次进行判断，若有则转发，否则接着往下考虑。
3. 直连路由>特定主机路由>静态路由>动态路由>默认路由
3. 如果全部失败着报告分组转发分组出错

### 子网划分
1. 基本思路，从主机号借用若干位作为子网号，加长网络号
2. 使用子网掩码，找出IP地址中的子网部分
3. 网络地址 ＝ IP地址 & 子网掩码
4. 使用子网后，分组转发需要先用子网掩码算出网络地址
5. IP地址为三级编址

### CIDR 无分类域间路由选择
1. IP地址为二级编址
2. ![](https://ooo.0o0.ooo/2017/06/25/594f7a3ce4712.png)
3. 斜线记法，在IP地址加上/数字表示子网掩码中1的个数

### RIP
1. 基于距离向量的路有选择协议
2. 要求网络中的每一个路由器都要维护从它自己倒其他每一个目的网络的距离记录
3. 仅和相邻路由器交换信息
4. 交换自己的路由表
5. 固定时间间隔交换路由信息

### 距离向量算法
- 距离为经过的路由器的跳数
1. 收到相邻路由器的RIP报文后，修改RIP报文的项目，把"下一跳"地址改为相邻路由器地址，并把距离字段的值加1
2. 对比该报文，若项目中不存在，则添加进去，若下一跳地址相同，替换原项目，若下一跳地址不同，比较大小，保留距离小的一项

### OSPF
1. 向本自治系统中所有路由器发送信息
2. 发送与本路由器相邻的所有路由器的链路状态
3. 当链路状态发生变化，才发送信息

### NAT:私有IP地址和公有IP地址之间的转换